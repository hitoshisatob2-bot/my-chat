<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kubota WSM aiã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</title>
    <style>
        body { font-family: sans-serif; margin: 0; background-color: #f5f5f5; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        .container { text-align: center; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 80%; max-width: 400px; }
        #voice-btn {
            background: #4285f4; color: white; border: none; border-radius: 50%; width: 60px; height: 60px; 
            font-size: 28px; cursor: pointer; margin-top: 20px; transition: 0.3s;
        }
        #voice-btn.recording { background: #ea4335; transform: scale(1.1); box-shadow: 0 0 15px rgba(234,67,53,0.5); }
    </style>
</head>
<body>

<div class="container" id="welcome-box">
    <h2>kubota WSM aiã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</h2>
    <p>ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨AIãƒãƒ£ãƒƒãƒˆãŒé–‹ãã¾ã™</p>
    <button id="searchWidgetTrigger" style="padding: 15px 30px; background-color: #4285f4; color: white; border: none; border-radius: 30px; font-weight: bold; cursor: pointer;">
        AIãƒãƒ£ãƒƒãƒˆã‚’èµ·å‹•ã™ã‚‹
    </button>
    
    <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">
    
    <p style="font-size: 14px; font-weight: bold; color: #333;">éŸ³å£°ã§æ¤œç´¢ã™ã‚‹</p>
    <button id="voice-btn">ğŸ™ï¸</button>
    <p id="status" style="font-size: 12px; color: #666; margin-top: 10px;">ãƒã‚¤ã‚¯ã‚’æŠ¼ã—ã¦å–‹ã£ã¦ãã ã•ã„</p>
</div>

<gen-search-widget
  configId="641e8208-ac63-4d51-a816-f864dfd00f27"
  triggerId="searchWidgetTrigger"
  max-results="1"
  enable-source-grounding="true"
  auth-type="public">
</gen-search-widget>

<script src="https://cloud.google.com/ai/gen-app-builder/client?hl=ja"></script>

<script>
    const voiceBtn = document.getElementById('voice-btn');
    const statusText = document.getElementById('status');
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    if (!SpeechRecognition) {
        statusText.innerText = "ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°å…¥åŠ›ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“";
    } else {
        const recognition = new SpeechRecognition();
        recognition.lang = 'ja-JP';
        recognition.interimResults = false;

        voiceBtn.onclick = () => {
            recognition.start();
        };

        recognition.onstart = () => {
            voiceBtn.classList.add('recording');
            statusText.innerText = "èãå–ã‚Šä¸­...";
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            statusText.innerText = "ã€Œ" + transcript + "ã€ã§æ¤œç´¢ã‚’é–‹å§‹ã—ã¾ã™...";
            
            // ãƒãƒ£ãƒƒãƒˆã‚’èµ·å‹•
            document.getElementById('searchWidgetTrigger').click();

            // â˜…ã“ã“ã‚’ä¿®æ­£ï¼šå¾…ã¡æ™‚é–“ã‚’2000ï¼ˆ2ç§’ï¼‰ã«å¢—ã‚„ã—ã¦ã€ç¢ºå®Ÿã«å…¥åŠ›çª“ã‚’æ•ã¾ãˆã‚‹
            setTimeout(() => {
                // ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå†…ã®æ¤œç´¢çª“ï¼ˆè¤‡æ•°ã®å€™è£œã‚’æ¢ã™ã‚ˆã†ã«å¼·åŒ–ï¼‰
                const searchInput = document.querySelector('input[type="search"]') || 
                                    document.querySelector('.gen-search-widget__input') ||
                                    document.getElementById('search-widget-input');
                                    
                if (searchInput) {
                    searchInput.value = transcript;
                    // å…¥åŠ›ç¢ºå®šã‚’Googleã«é€šçŸ¥
                    searchInput.dispatchEvent(new Event('input', { bubbles: true }));
                    searchInput.dispatchEvent(new Event('change', { bubbles: true }));
                    
                    // Enterã‚­ãƒ¼ã‚’å¼·ãã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                    const enterOptions = { key: 'Enter', code: 'Enter', keyCode: 13, which: 13, bubbles: true };
                    searchInput.dispatchEvent(new KeyboardEvent('keydown', enterOptions));
                    searchInput.dispatchEvent(new KeyboardEvent('keypress', enterOptions));
                    searchInput.dispatchEvent(new KeyboardEvent('keyup', enterOptions));
                }
                voiceBtn.classList.remove('recording');
            }, 2000); // 2ç§’å¾…æ©Ÿ
        };

        recognition.onerror = () => {
            voiceBtn.classList.remove('recording');
            statusText.innerText = "ã‚¨ãƒ©ãƒ¼ã€‚ã‚‚ã†ä¸€åº¦ãƒã‚¤ã‚¯ã‚’æŠ¼ã—ã¦ãã ã•ã„";
        };

        recognition.onend = () => {
            voiceBtn.classList.remove('recording');
        };
    }
</script>

</body>
</html>
